<view class="top-bar">
  <button type="primary" bindtap="toggleWeek">
    {{isSingleWeek ? '单周' : '双周'}}
  </button>
  <button type="default" bindtap="toggleCoursePool">
    {{showCoursePool ? '隐藏课程池' : '添加课程'}}
  </button>
  <button type="warn" bindtap="showAddCourseDialog">新建课程</button>
  <button type="warn" bindtap="showClearConfirm">清空数据</button>
</view>

<!-- 新建课程弹窗 -->
<view wx:if="{{showAddDialog}}" class="dialog-mask">
  <view class="dialog">
    <view class="dialog-title">添加课程到课程池</view>
    <input 
      class="dialog-input" 
      placeholder="输入课程名称和地点（如：语文@教A-101）"
      bindinput="onCourseNameInput"
      value="{{newCourseName}}"
    />
    <view class="dialog-btns">
      <button bindtap="cancelAddCourse">取消</button>
      <button type="primary" bindtap="confirmAddCourse">确认</button>
    </view>
  </view>
</view>

<!-- 课程池（选中样式） -->
<view wx:if="{{showCoursePool}}" class="course-pool">
  <view class="pool-title">
    课程池
    <text class="pool-hint">（点击选中课程，再点击课表添加，长按删除）</text>
    <text wx:if="{{selectedCourse}}" class="selected-hint">
      已选中：{{selectedCourse.kcmc}}
    </text>
  </view>
  <view class="pool-list">
    <view 
      class="pool-item {{selectedCourse && selectedCourse.id === item.id ? 'pool-item-selected' : ''}}"
      wx:for="{{coursePool}}" 
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="selectCourse"
      bindlongpress="deleteFromPool"
      style="user-select: none;"
    >
      {{item.kcmc}}
    </view>
  </view>
</view>

<!-- 清空数据确认弹窗 -->
<view wx:if="{{showClearDialog}}" class="dialog-mask">
  <view class="dialog">
    <view class="dialog-title">⚠️ 确认清空所有数据？</view>
    <view class="dialog-content">
      此操作将恢复为默认课表，删除所有课表、课程池及颜色设置，且无法恢复！
    </view>
    <view class="dialog-btns">
      <button bindtap="cancelClear">取消</button>
      <button type="warn" bindtap="confirmClear">确认清空</button>
    </view>
  </view>
</view>

<!-- 删除区域（仅课表课程长按拖动删除） -->
<view class="delete-area" wx:if="{{isDraggingTableCourse}}">
  <view class="delete-text">拖到此处删除</view>
</view>

<!-- 课表网格 -->
<view class="timetable">
  <!-- 星期标题 -->
  <view class="weekdays">
    <view class="weekday">周一</view>
    <view class="weekday">周二</view>
    <view class="weekday">周三</view>
    <view class="weekday">周四</view>
    <view class="weekday">周五</view>
    <view class="weekday">周六</view>
    <view class="weekday">周日</view>
  </view>

  <!-- 课程网格 -->
  <view class="grid-container">
    <view 
      class="grid-cell"
      wx:for="{{[1,2,3,4,5,6,7,8,9,10]}}" 
      wx:for-item="skjc"
      wx:key="skjc"
      data-skjc="{{skjc}}"
    >
      <view 
        class="grid-day {{selectedCourse ? 'grid-day-clickable' : ''}}"
        wx:for="{{[1,2,3,4,5,6,7]}}" 
        wx:for-item="xqj"
        wx:key="xqj"
        data-xqj="{{xqj}}"
        data-skjc="{{skjc}}"
        bindtap="addCourseToTable"
      >
        <!-- 已有课程显示 -->
        <view 
          class="course-item"
          wx:for="{{currentList}}"
          wx:key="id"
          wx:if="{{item.xqj === xqj && item.skjc === skjc}}"
          style="background-color:{{courseColorMap[item.kcmc]}}" 
          data-id="{{item.id}}"
          bindtouchstart="startDragFromTable"
          bindtouchmove="handleDragMove"
          bindtouchend="handleDragEnd"
        >
          <view class="course-name">{{item.kcmc}}</view>
        </view>
      </view>
    </view>
  </view>
</view>